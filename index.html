<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>>圣诞快乐 -送给最爱的宝贝</title>
    <!-- 引入 Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 React 和 Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- 引入 Lucide 图标库 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { margin: 0; background: #00050f; overflow: hidden; }
        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 5px rgba(255,255,255,0.3)); }
            50% { filter: drop-shadow(0 0 20px rgba(255,215,0,0.6)); }
        }
        @keyframes heartbeat {
            0% { transform: scale(1); }
            15% { transform: scale(1.3); }
            30% { transform: scale(1); }
            45% { transform: scale(1.15); }
            60% { transform: scale(1); }
        }
        .animate-glow { animation: glow 3s ease-in-out infinite; }
        .animate-fade-in-up { animation: fadeInUp 1s ease-out forwards; }
        .animate-heartbeat { 
            display: inline-block;
            animation: heartbeat 1.2s infinite; 
            color: #ff4d4d;
            text-shadow: 0 0 10px rgba(255, 77, 77, 0.8);
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        canvas { touch-action: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function ParticleChristmas() {
            const canvasRef = useRef(null);
            const [dimensions, setDimensions] = useState({ width: window.innerWidth, height: window.innerHeight });
            const [isPlaying, setIsPlaying] = useState(false);
            const audioRef = useRef(null);
            const [showText, setShowText] = useState(false);
            const [isMobile, setIsMobile] = useState(window.innerWidth < 768);
            
            const FOV = 250;
            const config = useRef({
                particleCount: isMobile ? 800 : 1800,
                treeHeight: isMobile ? window.innerHeight * 0.5 : 600,
                baseRadius: isMobile ? window.innerWidth * 0.35 : 250,
                yOffset: isMobile ? window.innerHeight * 0.1 : 100
            });
            
            const particles = useRef([]);
            const fireworks = useRef([]);
            const stars = useRef([]);
            const meteors = useRef([]);
            const rotation = useRef(0);

            useEffect(() => {
                const handleResize = () => {
                    const w = window.innerWidth;
                    const h = window.innerHeight;
                    const mobile = w < 768;
                    setIsMobile(mobile);
                    setDimensions({ width: w, height: h });
                    config.current = {
                        particleCount: mobile ? 800 : 1800,
                        treeHeight: mobile ? h * 0.5 : 600,
                        baseRadius: mobile ? w * 0.35 : 250,
                        yOffset: mobile ? h * 0.1 : 100
                    };
                    if (canvasRef.current) {
                        canvasRef.current.width = w;
                        canvasRef.current.height = h;
                    }
                    initWorld();
                };
                window.addEventListener('resize', handleResize);
                handleResize();
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            useEffect(() => {
                let animationFrameId;
                const ctx = canvasRef.current.getContext('2d');
                const render = () => {
                    ctx.fillStyle = 'rgba(0, 5, 15, 0.2)'; 
                    ctx.fillRect(0, 0, dimensions.width, dimensions.height);
                    const centerX = dimensions.width / 2;
                    const centerY = dimensions.height / 2 + config.current.yOffset;
                    
                    // Stars
                    stars.current.forEach(star => {
                        const alpha = 0.3 + Math.sin(Date.now() * star.blinkSpeed) * 0.3;
                        ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                        ctx.beginPath(); ctx.arc(star.x, star.y, star.size, 0, Math.PI*2); ctx.fill();
                    });

                    // Tree
                    rotation.current += 0.005; 
                    particles.current.forEach(p => {
                        const cos = Math.cos(rotation.current);
                        const sin = Math.sin(rotation.current);
                        const x = p.x * cos - p.z * sin;
                        const z = p.z * cos + p.x * sin;
                        const scale = FOV / (FOV + z + 400);
                        if (scale > 0) {
                            const x2d = x * scale + centerX;
                            const y2d = p.y * scale + centerY;
                            const hue = p.y < -config.current.treeHeight/2 + 30 ? 50 : (140 + Math.random() * 40); 
                            ctx.fillStyle = `hsla(${hue}, 100%, 70%, ${(scale - 0.1) * p.alpha})`;
                            ctx.beginPath(); ctx.arc(x2d, y2d, p.size * scale, 0, Math.PI * 2); ctx.fill();
                        }
                    });

                    // Fireworks
                    fireworks.current.forEach((fw, i) => {
                        fw.x += fw.vx; fw.y += fw.vy; fw.vy += 0.1; fw.life -= 0.02;
                        if (fw.life <= 0) { fireworks.current.splice(i, 1); return; }
                        ctx.fillStyle = fw.color; ctx.globalAlpha = fw.life;
                        ctx.beginPath(); 
                        if (fw.isHeart) {
                            // Draw a simple heart shape for special particles
                            const s = 4 * fw.life;
                            ctx.moveTo(fw.x, fw.y);
                            ctx.bezierCurveTo(fw.x, fw.y - s, fw.x - s*2, fw.y - s, fw.x - s*2, fw.y + s);
                            ctx.bezierCurveTo(fw.x - s*2, fw.y + s*3, fw.x, fw.y + s*4, fw.x, fw.y + s*5);
                            ctx.bezierCurveTo(fw.x, fw.y + s*4, fw.x + s*2, fw.y + s*3, fw.x + s*2, fw.y + s);
                            ctx.bezierCurveTo(fw.x + s*2, fw.y - s, fw.x, fw.y - s, fw.x, fw.y);
                        } else {
                            ctx.arc(fw.x, fw.y, 2, 0, Math.PI * 2);
                        }
                        ctx.fill();
                    });
                    ctx.globalAlpha = 1;

                    animationFrameId = requestAnimationFrame(render);
                };
                render();
                return () => cancelAnimationFrame(animationFrameId);
            }, [dimensions]);

            const initWorld = () => {
                const { particleCount, treeHeight, baseRadius } = config.current;
                particles.current = Array.from({ length: particleCount }, (_, i) => {
                    const p = i / particleCount;
                    const angle = i * Math.PI * 13;
                    const y = -treeHeight/2 + p * treeHeight;
                    const r = baseRadius * (1 - p) + (Math.random() - 0.5) * 20;
                    return { x: Math.cos(angle) * r, y, z: Math.sin(angle) * r, size: Math.random() * 2 + 1, alpha: Math.random() * 0.5 + 0.5 };
                });
                stars.current = Array.from({ length: 100 }, () => ({
                    x: Math.random() * window.innerWidth, y: Math.random() * window.innerHeight, size: Math.random() * 1.2, blinkSpeed: Math.random() * 0.05
                }));
            };

            const handleInteraction = (e) => {
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                if (!isPlaying && audioRef.current) {
                    audioRef.current.play();
                    setIsPlaying(true);
                }
                setShowText(true);
                
                // Create Fireworks (Normal & Heart shaped)
                const colors = ['#ffeb3b', '#ff4d4d', '#ff80ab'];
                for(let i=0; i<25; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = Math.random() * 4 + 2;
                    const isHeart = Math.random() > 0.6;
                    fireworks.current.push({ 
                        x: clientX, 
                        y: clientY, 
                        vx: Math.cos(angle) * speed, 
                        vy: Math.sin(angle) * speed, 
                        life: 1, 
                        color: colors[Math.floor(Math.random() * colors.length)],
                        isHeart: isHeart
                    });
                }
            };

            return (
                <div className="relative w-full h-screen overflow-hidden bg-[#00050f] touch-none select-none" onClick={handleInteraction}>
                    <canvas ref={canvasRef} className="absolute top-0 left-0 z-10 w-full h-full" />
                    <audio ref={audioRef} loop src="https://pixabay.com/music/download/music-128256.mp3?filename=christmas-piano-128256.mp3" />
                    
                    <div className={`absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-40 w-[90%] pointer-events-none transition-all duration-1000 ${showText ? 'opacity-100 scale-100' : 'opacity-0 scale-90 translate-y-10'}`}>
                        <div className="text-center bg-black/30 backdrop-blur-md p-6 md:p-10 rounded-3xl border border-white/10 shadow-[0_0_50px_rgba(255,50,50,0.2)]">
                            <h1 className="text-4xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-red-500 via-yellow-200 to-green-500 mb-4 animate-glow">
                                Merry Christmas
                            </h1>
                            <p className="text-lg md:text-2xl text-white font-serif tracking-[0.2em]">
                                致我最爱的宝贝 <span className="animate-heartbeat">❤️</span>
                            </p>
                        </div>
                    </div>

                    {!showText && (
                        <div className="absolute bottom-16 left-1/2 transform -translate-x-1/2 z-40 text-white/40 flex flex-col items-center gap-2 animate-pulse">
                            <span className="text-sm tracking-widest">点击屏幕开启惊喜</span>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ParticleChristmas />);
    </script>
</body>
</html>
